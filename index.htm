<div class="ddos-sim" id="ddosSim">
  <div class="ddos-header">
    <div>
      <h2>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤: ¬´–í–∞—à —Å–∞–π—Ç –ø–æ–¥ DDoS-–∞—Ç–∞–∫–æ–π¬ª</h2>
      <p class="ddos-sub">
        –í—ã ‚Äî –∞–¥–º–∏–Ω –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞. –†–µ–∞–≥–∏—Ä—É–π—Ç–µ –Ω–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç, –≤—ã–±–∏—Ä–∞—è –¥–µ–π—Å—Ç–≤–∏—è. –ö–∞–∂–¥—ã–π —à–∞–≥ = 10 –º–∏–Ω—É—Ç.
      </p>
    </div>
    <button class="ddos-btn ddos-btn-ghost" type="button" data-action="reset">–°–±—Ä–æ—Å</button>
  </div>

  <div class="ddos-stats" aria-live="polite">
    <div class="ddos-stat">
      <div class="ddos-stat-k">–í—Ä–µ–º—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞</div>
      <div class="ddos-stat-v"><span data-stat="minutes">0</span> –º–∏–Ω</div>
    </div>
    <div class="ddos-stat">
      <div class="ddos-stat-k">–ü—Ä–æ—Å—Ç–æ–π —Å–∞–π—Ç–∞</div>
      <div class="ddos-stat-v"><span data-stat="downtime">0</span> –º–∏–Ω</div>
    </div>
    <div class="ddos-stat">
      <div class="ddos-stat-k">–ü–æ—Ç–µ—Ä–∏</div>
      <div class="ddos-stat-v">‚ÇΩ <span data-stat="loss">0</span></div>
    </div>
    <div class="ddos-stat">
      <div class="ddos-stat-k">–†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —É—Ä–æ–Ω</div>
      <div class="ddos-stat-v"><span data-stat="rep">0</span> / 100</div>
    </div>
  </div>

  <div class="ddos-card">
    <div class="ddos-time">–°–∏—Ç—É–∞—Ü–∏—è</div>
    <div class="ddos-scene" data-ui="scene"></div>

    <div class="ddos-choices" data-ui="choices"></div>

    <div class="ddos-feedback" data-ui="feedback" hidden></div>

    <div class="ddos-footer">
      <div class="ddos-tip" data-ui="tip"></div>
      <div class="ddos-actions">
        <button class="ddos-btn" type="button" data-action="back" disabled>–ù–∞–∑–∞–¥</button>
        <button class="ddos-btn" type="button" data-action="next" disabled>–î–∞–ª—å—à–µ</button>
      </div>
    </div>
  </div>
</div>

<style>
  .ddos-sim{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;max-width:860px;margin:20px auto;padding:18px;border:1px solid #e6e6e6;border-radius:16px;background:#fff}
  .ddos-header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:14px}
  .ddos-header h2{margin:0;font-size:20px;line-height:1.2}
  .ddos-sub{margin:6px 0 0;color:#555;font-size:14px}
  .ddos-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:12px 0 16px}
  .ddos-stat{border:1px solid #efefef;border-radius:14px;padding:10px 12px;background:#fafafa}
  .ddos-stat-k{color:#666;font-size:12px;margin-bottom:4px}
  .ddos-stat-v{font-weight:700;font-size:16px}
  .ddos-card{border:1px solid #efefef;border-radius:16px;padding:14px}
  .ddos-time{font-size:12px;color:#777;margin-bottom:6px}
  .ddos-scene{font-size:16px;line-height:1.4;margin-bottom:12px}
  .ddos-choices{display:grid;gap:10px;margin:12px 0}
  .ddos-choice{border:1px solid #e8e8e8;border-radius:14px;padding:12px;background:#fff;cursor:pointer;text-align:left;transition:transform .04s ease, border-color .12s ease, background .12s ease}
  .ddos-choice:hover{border-color:#d8d8d8;background:#fcfcfc}
  .ddos-choice:active{transform:translateY(1px)}
  .ddos-choice strong{display:block;margin-bottom:4px}
  .ddos-choice small{color:#666}
  .ddos-choice[aria-pressed="true"]{border-color:#111;background:#f4f4f4}
  .ddos-feedback{margin-top:10px;border-radius:14px;padding:12px;background:#f7f7ff;border:1px solid #e2e2ff}
  .ddos-feedback .ddos-badge{display:inline-block;font-size:12px;padding:2px 8px;border-radius:999px;background:#111;color:#fff;margin-right:8px}
  .ddos-footer{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:12px}
  .ddos-tip{color:#666;font-size:13px;max-width:64%}
  .ddos-actions{display:flex;gap:8px}
  .ddos-btn{border:1px solid #111;background:#111;color:#fff;border-radius:12px;padding:10px 12px;cursor:pointer;font-weight:600}
  .ddos-btn:disabled{opacity:.4;cursor:not-allowed}
  .ddos-btn-ghost{background:#fff;color:#111}
  @media (max-width:820px){.ddos-stats{grid-template-columns:repeat(2,1fr)}.ddos-tip{max-width:100%}.ddos-footer{flex-direction:column;align-items:stretch}.ddos-actions{justify-content:flex-end}}
</style>

<script>
(() => {
  // --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∏–∑–Ω–µ—Å–∞
  const revenuePerDay = 300000;               // ‚ÇΩ/–¥–µ–Ω—å
  const revenuePerMinute = revenuePerDay / (24 * 60); // ‚ÇΩ/–º–∏–Ω –ø—Ä–æ—Å—Ç–æ—è

  // --- –£—Å–∏–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –¥–ª—è "–ø–ª–æ—Ö–∏—Ö" —Ä–µ—à–µ–Ω–∏–π
  // downtimeMult: —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ø—Ä–æ—Å—Ç–æ–π (=> –ø—Ä—è–º—ã–µ –ø–æ—Ç–µ—Ä–∏)
  // repMult: —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —É—Ä–æ–Ω
  // churnRatePerStep: –¥–æ–±–∞–≤–ª—è–µ—Ç "—Å–∫—Ä—ã—Ç—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å" (–æ—Ç—Ç–æ–∫/–ø–∞–¥–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏) –∫–∞–∫ –¥–æ–ª—é –¥–Ω–µ–≤–Ω–æ–π –≤—ã—Ä—É—á–∫–∏ –∑–∞ —à–∞–≥
  const SEVERITY = {
    good:     { downtimeMult: 1.0, repMult: 1.0, churnRatePerStep: 0.000 }, // 0%
    ok:       { downtimeMult: 1.1, repMult: 1.15, churnRatePerStep: 0.010 }, // 1%
    bad:      { downtimeMult: 1.35, repMult: 1.60, churnRatePerStep: 0.035 }, // 3.5%
    terrible: { downtimeMult: 1.70, repMult: 2.10, churnRatePerStep: 0.070 }  // 7%
  };

  // --- –°—Ü–µ–Ω–∞—Ä–∏–π
  const nodes = {
    start: {
      title: "10:02. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥",
      text:
`üî∫ CPU 95%
üî∫ –ó–∞–ø—Ä–æ—Å–æ–≤ –≤ 20 —Ä–∞–∑ –±–æ–ª—å—à–µ –∑–∞ 5 –º–∏–Ω—É—Ç
üî∫ –ñ–∞–ª–æ–±—ã: ¬´—Å–∞–π—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç¬ª

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç–µ?`,
      tip: "–ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ª–µ—á–∏—Ç —Å–∏–º–ø—Ç–æ–º—ã. –°–Ω–∞—á–∞–ª–∞ ‚Äî –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞.",
      choices: [
        {
          label: "–ü–µ—Ä–µ–∑–∞–ø—É—â—É —Å–µ—Ä–≤–µ—Ä",
          desc: "–ë—ã—Å—Ç—Ä–æ, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –ø–æ–º–æ–≥–∞–µ—Ç",
          severity: "bad",
          effect: { minutes: 10, downtime: 2, rep: 6, lossExtra: 0 },
          feedback: {
            badge: "üìâ –ü–ª–æ—Ö–æ",
            text: "–°–∞–π—Ç —É–ø–∞–ª –Ω–∞ 2 –º–∏–Ω—É—Ç—ã, –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞ —É–ø—ë—Ä—Å—è –≤ 100% –Ω–∞–≥—Ä—É–∑–∫–∏. –ü—Ä–∏ DDoS –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ä–µ–¥–∫–æ –ø–æ–º–æ–≥–∞–µ—Ç ‚Äî –ø—Ä–∏—á–∏–Ω–∞ –æ—Å—Ç–∞—ë—Ç—Å—è."
          },
          next: "stage2_unconfirmed"
        },
        {
          label: "–ü–æ–¥–æ–∂–¥—É, –º–æ–∂–µ—Ç —Å–∞–º–æ –ø—Ä–æ–π–¥—ë—Ç",
          desc: "–ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—é",
          severity: "terrible",
          effect: { minutes: 10, downtime: 10, rep: 12, lossExtra: 0 },
          feedback: {
            badge: "‚õî –û—á–µ–Ω—å –ø–ª–æ—Ö–æ",
            text: "–ó–∞ 10 –º–∏–Ω—É—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –ø–æ–ª—É—á–∞—Ç—å –æ—à–∏–±–∫–∏. DDoS —Ä–µ–¥–∫–æ ¬´—Å–∞–º –ø—Ä–æ—Ö–æ–¥–∏—Ç¬ª. –ß–µ–º –¥–æ–ª—å—à–µ –∂–¥—ë—Ç–µ ‚Äî —Ç–µ–º –¥–æ—Ä–æ–∂–µ."
          },
          next: "stage2_worse"
        },
        {
          label: "–ü—Ä–æ–≤–µ—Ä—é –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ –ª–æ–≥–∏",
          desc: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏—è–º–∏",
          severity: "good",
          effect: { minutes: 10, downtime: 1, rep: 2, lossExtra: 0 },
          feedback: {
            badge: "‚úÖ –í–µ—Ä–Ω–æ",
            text: "–í—ã –≤–∏–¥–∏—Ç–µ —Ç—ã—Å—è—á–∏ IP –∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã. –ü–æ—Ö–æ–∂–µ –Ω–∞ –±–æ—Ç–Ω–µ—Ç –∏ –∞—Ç–∞–∫—É —É—Ä–æ–≤–Ω—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (L7)."
          },
          next: "stage2_confirmed"
        }
      ]
    },

    stage2_unconfirmed: {
      title: "10:12. –ù–∞–≥—Ä—É–∑–∫–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å",
      text:
`–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ–º–æ–≥ –Ω–∞ –º–∏–Ω—É—Ç—ã.
–°–∞–π—Ç –æ–ø—è—Ç—å —Ç–æ—Ä–º–æ–∑–∏—Ç. –ü–æ—Ö–æ–∂–µ, —ç—Ç–æ –Ω–µ ¬´–≥–ª—é–∫¬ª.

–ß—Ç–æ –¥–∞–ª—å—à–µ?`,
      tip: "–ë–µ–∑ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ª–µ–≥–∫–æ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–µ —à–∞–≥–∏.",
      choices: [
        {
          label: "–ù–∞—á–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å IP –≤—Ä—É—á–Ω—É—é",
          desc: "–ó–∞–ø—Ä–µ—â–∞—é –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∞–¥—Ä–µ—Å–∞",
          severity: "bad",
          effect: { minutes: 10, downtime: 4, rep: 8, lossExtra: 0 },
          feedback: { badge: "üìâ –ü–ª–æ—Ö–æ", text: "–í—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ —Å–æ—Ç–Ω–∏ IP ‚Äî –ø–æ—è–≤–∏–ª–∏—Å—å —Ç—ã—Å—è—á–∏ –Ω–æ–≤—ã—Ö. –ü—Ä–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –∞—Ç–∞–∫–µ IP –±—ã—Å—Ç—Ä–æ –º–µ–Ω—è—é—Ç—Å—è." },
          next: "stage3_secondwave"
        },
        {
          label: "–ü—Ä–æ–≤–µ–¥—É –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É (—Å—Ç—Ä–∞–Ω—ã, user-agent, —á–∞—Å—Ç–æ—Ç–∞)",
          desc: "–¢–µ–ø–µ—Ä—å —Å–æ–±–∏—Ä–∞—é –ø—Ä–∏–∑–Ω–∞–∫–∏ –∞—Ç–∞–∫–∏",
          severity: "ok",
          effect: { minutes: 10, downtime: 2, rep: 4, lossExtra: 0 },
          feedback: { badge: "üü° –ù–æ—Ä–º", text: "–ü–æ–∑–¥–Ω–æ–≤–∞—Ç–æ, –Ω–æ –≤—ã —Å–æ–±—Ä–∞–ª–∏ –ø—Ä–∏–∑–Ω–∞–∫–∏: –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è GET –Ω–∞ –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω–∏—Ü—É, –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ user-agent, –≤—Å–ø–ª–µ—Å–∫ –ø–æ ASN." },
          next: "stage2_confirmed"
        }
      ]
    },

    stage2_worse: {
      title: "10:12. –°–∞–π—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ª—ë–≥",
      text:
`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–∞—Å—Å–æ–≤–æ –ø–æ–ª—É—á–∞—é—Ç 502/504.
–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–≤–∞–ª–µ–Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è–º–∏.

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç–µ –°–ï–ô–ß–ê–°?`,
      tip: "–ö–æ–≥–¥–∞ —É–∂–µ ¬´–≥–æ—Ä–∏—Ç¬ª, –≤–∞–∂–Ω—ã –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —É–º–µ–Ω—å—à–∞—é—Ç —Ç—Ä–∞—Ñ–∏–∫ –î–û –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.",
      choices: [
        {
          label: "–ü–æ–¥–∫–ª—é—á—É CDN",
          desc: "–ö—ç—à + –±–∞–∑–æ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è",
          severity: "ok",
          effect: { minutes: 10, downtime: 6, rep: 10, lossExtra: 0 },
          feedback: { badge: "üü° –ß–∞—Å—Ç–∏—á–Ω–æ", text: "–ß–∞—Å—Ç—å —Ç—Ä–∞—Ñ–∏–∫–∞ –æ—Ç—Å–µ—è–ª–∞—Å—å/–∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–ª–∞—Å—å, –Ω–æ L7-–∞—Ç–∞–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø—Ä–æ–±–∏–≤–∞—Ç—å—Å—è." },
          next: "stage3_secondwave"
        },
        {
          label: "–í–∫–ª—é—á—É WAF + rate limiting",
          desc: "–†–µ–∂—É –±–æ—Ç–æ–≤ –ø–æ –ø–æ–≤–µ–¥–µ–Ω–∏—é",
          severity: "good",
          effect: { minutes: 10, downtime: 3, rep: 6, lossExtra: 0 },
          feedback: { badge: "‚úÖ –•–æ—Ä–æ—à–æ", text: "–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—É—á–∞—é—Ç 429, –±–æ—Ç—ã —Ç–µ—Ä—è—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å. –°–∞–π—Ç —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–∞ –≤—Ç–æ—Ä–∞—è –≤–æ–ª–Ω–∞." },
          next: "stage3_secondwave"
        },
        {
          label: "–ú–∞—Å—à—Ç–∞–±–∏—Ä—É—é —Å–µ—Ä–≤–µ—Ä (–±–æ–ª—å—à–µ CPU/–∏–Ω—Å—Ç–∞–Ω—Å–æ–≤)",
          desc: "–ü–æ–∫—É–ø–∞—é –º–æ—â–Ω–æ—Å—Ç—å",
          severity: "bad",
          effect: { minutes: 10, downtime: 5, rep: 9, lossExtra: 12000 },
          feedback: { badge: "üü† –î–æ—Ä–æ–≥–æ", text: "–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –Ω–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –Ω–æ –∞—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –±—ã—Å—Ç—Ä–µ–µ. –ü–ª—é—Å –ª–∏—à–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É." },
          next: "stage3_secondwave"
        }
      ]
    },

    stage2_confirmed: {
      title: "10:12. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–∞—è DDoS (L7)",
      text:
`80% –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–¥—É—Ç —Å —Ç—ã—Å—è—á IP.
–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ –±–æ—Ç–æ–≤: —á–∞—Å—Ç—ã–µ GET –∫ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã.

–ß—Ç–æ –≤–Ω–µ–¥—Ä—è–µ–º?`,
      tip: "–î–ª—è L7 —á–∞—Å—Ç–æ —Ä–µ—à–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–≤–µ–¥–µ–Ω–∏—é (WAF/rate limiting), –∞ –Ω–µ ¬´–±–∞–Ω –ø–æ IP¬ª.",
      choices: [
        {
          label: "–ó–∞–±–ª–æ–∫–∏—Ä—É—é IP –≤—Ä—É—á–Ω—É—é",
          desc: "–ß—ë—Ä–Ω—ã–µ —Å–ø–∏—Å–∫–∏",
          severity: "bad",
          effect: { minutes: 10, downtime: 3, rep: 6, lossExtra: 0 },
          feedback: { badge: "üìâ –ü–ª–æ—Ö–æ", text: "IP –º–µ–Ω—è—é—Ç—Å—è, –±–æ—Ç—ã –∂–∏–≤—É—Ç –¥–∞–ª—å—à–µ. –≠—Ç–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å —Ç–æ—á–µ—á–Ω–æ, –Ω–æ –Ω–µ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è." },
          next: "stage3_secondwave"
        },
        {
          label: "CDN + –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏",
          desc: "–†–∞–∑–≥—Ä—É–∂–∞—é —Å–µ—Ä–≤–µ—Ä",
          severity: "ok",
          effect: { minutes: 10, downtime: 2, rep: 3, lossExtra: 0 },
          feedback: { badge: "üü° –ù–µ–ø–ª–æ—Ö–æ", text: "CDN —Å–Ω–∏–º–∞–µ—Ç —á–∞—Å—Ç—å –Ω–∞–≥—Ä—É–∑–∫–∏, –Ω–æ ¬´—É–º–Ω—ã–µ¬ª L7-–±–æ—Ç—ã –º–æ–≥—É—Ç –ø—Ä–æ–±–∏–≤–∞—Ç—å—Å—è –∫ –¥–∏–Ω–∞–º–∏–∫–µ." },
          next: "stage3_secondwave"
        },
        {
          label: "WAF + rate limiting + –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ URL",
          desc: "–†–µ–∂—É –∞–Ω–æ–º–∞–ª–∏–∏ –∏ —á–∞—Å—Ç–æ—Ç—É",
          severity: "good",
          effect: { minutes: 10, downtime: 1, rep: 1, lossExtra: 0 },
          feedback: { badge: "‚úÖ –û—Ç–ª–∏—á–Ω–æ", text: "–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ä–µ–∑–∫–æ —É–º–µ–Ω—å—à–∞–µ—Ç –≤–ª–∏—è–Ω–∏–µ L7. –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è –∑–∞–º–µ—Ç–Ω–æ –Ω–∏–∂–µ." },
          next: "stage3_secondwave"
        }
      ]
    },

    stage3_secondwave: {
      title: "11:00. –í—Ç–æ—Ä–∞—è –≤–æ–ª–Ω–∞ (SYN flood)",
      text:
`–ê—Ç–∞–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è: –º–Ω–æ–≥–æ TCP SYN.
–°–µ—Ä–≤–µ—Ä—É —Ç—è–∂–µ–ª–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –Ω–æ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

–í–∞—à —Ö–æ–¥:`,
      tip: "–ù–∞ —Å–µ—Ç–µ–≤—ã–µ –∞—Ç–∞–∫–∏ –ª—É—á—à–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞—â–∏—Ç–∞ ¬´–¥–æ –≤—Ö–æ–¥–∞¬ª (Anycast/–∞–Ω—Ç–∏-DDoS –ø—Ä–æ–≤–∞–π–¥–µ—Ä).",
      choices: [
        {
          label: "–£–≤–µ–ª–∏—á—É –º–æ—â–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞",
          desc: "–ë–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤",
          severity: "bad",
          effect: { minutes: 10, downtime: 4, rep: 8, lossExtra: 15000 },
          feedback: { badge: "üü† –í—Ä–µ–º–µ–Ω–Ω–æ–µ", text: "–î–∞—ë—Ç –ø–µ—Ä–µ–¥—ã—à–∫—É, –Ω–æ –∞—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç —É—Å–∏–ª–∏—Ç—å –ø–æ—Ç–æ–∫. –ü–ª–∞—Ç–∏—Ç–µ –±–æ–ª—å—à–µ ‚Äî –∞ —Ä–∏—Å–∫ –æ—Å—Ç–∞—ë—Ç—Å—è." },
          next: "final_mid"
        },
        {
          label: "–ü–æ–¥–∫–ª—é—á—É –∞–Ω—Ç–∏-DDoS (Anycast/—Å–∫—Ä–∞–±–±–∏–Ω–≥)",
          desc: "–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞",
          severity: "good",
          effect: { minutes: 10, downtime: 1, rep: 2, lossExtra: 0 },
          feedback: { badge: "‚úÖ –õ—É—á—à–µ–µ", text: "–¢—Ä–∞—Ñ–∏–∫ –æ—á–∏—â–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞/—Å–µ—Ç–∏, –¥–æ –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ—Ö–æ–¥–∏—Ç ¬´–Ω–æ—Ä–º–∞–ª—å–Ω—ã–π¬ª –ø–æ—Ç–æ–∫." },
          next: "final_good"
        },
        {
          label: "–ù–∏—á–µ–≥–æ ‚Äî –ø–µ—Ä–µ–∂–∏–≤—ë–º",
          desc: "–ù–∞–¥–µ—é—Å—å, —Å–∞–º–æ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è",
          severity: "terrible",
          effect: { minutes: 10, downtime: 10, rep: 15, lossExtra: 0 },
          feedback: { badge: "‚õî –û—á–µ–Ω—å –ø–ª–æ—Ö–æ", text: "SYN flood –±—ã—Å—Ç—Ä–æ –∫–ª–∞–¥—ë—Ç –∫–æ–Ω–Ω–µ–∫—Ç—ã. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–∞—Å—Å–æ–≤–æ —É—Ö–æ–¥—è—Ç –∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º." },
          next: "final_bad"
        }
      ]
    },

    final_good: {
      title: "–§–∏–Ω–∞–ª: –í—ã –ø–µ—Ä–µ–∂–∏–ª–∏ –∞—Ç–∞–∫—É",
      text:
`–í—ã –±—ã—Å—Ç—Ä–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—É, –≤–∫–ª—é—á–∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∏ –≤—ã–Ω–µ—Å–ª–∏ –∑–∞—â–∏—Ç—É ¬´–Ω–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä¬ª.

–ò—Ç–æ–≥: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏, —Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–ª –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏.`,
      tip: "–í—ã–≤–æ–¥: –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ + —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è + –∑–∞—â–∏—Ç–∞ –¥–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.",
      isFinal: true
    },
    final_mid: {
      title: "–§–∏–Ω–∞–ª: –í—ã –≤—ã–∂–∏–ª–∏, –Ω–æ –¥–æ—Ä–æ–≥–æ",
      text:
`–°–∞–π—Ç –¥–µ—Ä–∂–∞–ª—Å—è –∑–∞ —Å—á—ë—Ç —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –º–µ—Ä.

–ò—Ç–æ–≥: –ø–æ—Ç–µ—Ä–∏ –¥–µ–Ω–µ–≥ + –ª–∏—à–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥—ã + —á–∞—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É—à–ª–∞.`,
      tip: "–í—ã–≤–æ–¥: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç, –Ω–æ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –∞–Ω—Ç–∏-DDoS.",
      isFinal: true
    },
    final_bad: {
      title: "–§–∏–Ω–∞–ª: –°–∞–π—Ç –ª—ë–≥",
      text:
`–ë–µ–∑ –∑–∞—â–∏—Ç—ã –∏ –±—ã—Å—Ç—Ä—ã—Ö –º–µ—Ä –∞—Ç–∞–∫–∞ –¥–æ–±–∏–ª–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É.

–ò—Ç–æ–≥: –ø—Ä–æ—Å—Ç–æ–π, –ø–æ—Ç–µ—Ä–∏ –≤—ã—Ä—É—á–∫–∏ –∏ —É–¥–∞—Ä –ø–æ –¥–æ–≤–µ—Ä–∏—é.`,
      tip: "–í—ã–≤–æ–¥: –ø–ª–∞–Ω —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ª—É—á—à–µ –∏–º–µ—Ç—å –î–û –∞—Ç–∞–∫–∏.",
      isFinal: true
    }
  };

  // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ
  const state = {
    nodeId: "start",
    minutes: 0,
    downtime: 0,
    rep: 0,
    loss: 0,
    _extras: 0,     // –ø—Ä—è–º—ã–µ –¥–æ–ø.—Ä–∞—Å—Ö–æ–¥—ã (–∏–Ω—Ñ—Ä–∞/–∞–≤–∞—Ä–∏–π–∫–∞)
    _churn: 0,      // "—Å–∫—Ä—ã—Ç—ã–µ" –ø–æ—Ç–µ—Ä–∏ –æ—Ç –æ—Ç—Ç–æ–∫–∞/—Å–Ω–∏–∂–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
    history: []
  };

  const root = document.getElementById("ddosSim");
  const ui = {
    scene: root.querySelector('[data-ui="scene"]'),
    choices: root.querySelector('[data-ui="choices"]'),
    feedback: root.querySelector('[data-ui="feedback"]'),
    tip: root.querySelector('[data-ui="tip"]'),
    btnNext: root.querySelector('[data-action="next"]'),
    btnBack: root.querySelector('[data-action="back"]'),
    btnReset: root.querySelector('[data-action="reset"]'),
    statMinutes: root.querySelector('[data-stat="minutes"]'),
    statDowntime: root.querySelector('[data-stat="downtime"]'),
    statLoss: root.querySelector('[data-stat="loss"]'),
    statRep: root.querySelector('[data-stat="rep"]')
  };

  function formatMoney(n){
    return Math.max(0, Math.round(n)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
  }

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function recalcLoss(){
    const downtimeLoss = state.downtime * revenuePerMinute;
    state.loss = downtimeLoss + (state._extras || 0) + (state._churn || 0);
  }

  function renderStats(){
    recalcLoss();
    ui.statMinutes.textContent = state.minutes;
    ui.statDowntime.textContent = state.downtime;
    ui.statLoss.textContent = formatMoney(state.loss);
    ui.statRep.textContent = clamp(state.rep, 0, 100);
  }

  function renderNode(){
    const node = nodes[state.nodeId];

    ui.scene.innerHTML = `<div style="font-weight:800;margin-bottom:6px">${node.title}</div>
                          <div style="white-space:pre-line">${node.text}</div>`;

    ui.tip.textContent = node.tip || "";
    ui.feedback.hidden = true;
    ui.feedback.innerHTML = "";

    ui.choices.innerHTML = "";
    ui.btnNext.disabled = true;
    ui.btnBack.disabled = state.history.length === 0;

    if (node.isFinal){
      const rep = clamp(state.rep, 0, 100);
      ui.choices.innerHTML = `
        <div class="ddos-feedback" style="background:#f6fff6;border-color:#d7f5d7">
          <span class="ddos-badge">üèÅ –ò—Ç–æ–≥</span>
          <strong>–ü–æ—Ç–µ—Ä–∏:</strong> ‚ÇΩ ${formatMoney(state.loss)} ¬∑
          <strong>–ü—Ä–æ—Å—Ç–æ–π:</strong> ${state.downtime} –º–∏–Ω ¬∑
          <strong>–†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —É—Ä–æ–Ω:</strong> ${rep}/100
          <div style="margin-top:8px;color:#333">
            <strong>–í–∞–∂–Ω–æ:</strong> ¬´–°–∫—Ä—ã—Ç—ã–µ¬ª –ø–æ—Ç–µ—Ä–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç –æ—Ç—Ç–æ–∫/–ø–∞–¥–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–æ—Å–ª–µ –ø–ª–æ—Ö–∏—Ö —Ä–µ—à–µ–Ω–∏–π –≤–æ –≤—Ä–µ–º—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞.
          </div>
        </div>
      `;
      ui.btnNext.disabled = true;
      return;
    }

    node.choices.forEach((c, idx) => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "ddos-choice";
      btn.setAttribute("aria-pressed", "false");
      btn.innerHTML = `<strong>${c.label}</strong><small>${c.desc}</small>`;
      btn.addEventListener("click", () => selectChoice(idx));
      ui.choices.appendChild(btn);
    });
  }

  let selectedIndex = null;
  let pendingNext = null;

  function computeAppliedEffect(choice){
    const sevKey = choice.severity || "ok";
    const s = SEVERITY[sevKey] || SEVERITY.ok;

    const base = choice.effect;

    // –£—Å–∏–ª–µ–Ω–∏–µ –¥–ª—è –ø–ª–æ—Ö–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
    const downtime = Math.round(base.downtime * s.downtimeMult);
    const rep = Math.round(base.rep * s.repMult);

    // "–°–∫—Ä—ã—Ç–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å" ‚Äî –¥–æ–ª—è –¥–Ω–µ–≤–Ω–æ–π –≤—ã—Ä—É—á–∫–∏ –∑–∞ –∫–∞–∂–¥—ã–π —à–∞–≥, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç severity
    // –ù–∞–ø—Ä–∏–º–µ—Ä, terrible –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–º–µ—Ç–Ω—ã–π –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π —Ö–≤–æ—Å—Ç –∏–∑-–∑–∞ –Ω–µ–¥–æ–≤–µ—Ä–∏—è/–æ—Ç—Ç–æ–∫–∞.
    const churn = Math.round(revenuePerDay * s.churnRatePerStep);

    const lossExtra = base.lossExtra || 0;

    return {
      minutes: base.minutes,
      downtime,
      rep,
      lossExtra,
      churn,
      sevKey
    };
  }

  function selectChoice(idx){
    const node = nodes[state.nodeId];
    const choice = node.choices[idx];
    selectedIndex = idx;
    pendingNext = choice.next;

    [...ui.choices.querySelectorAll(".ddos-choice")].forEach((el, i) => {
      el.setAttribute("aria-pressed", i === idx ? "true" : "false");
    });

    const applied = computeAppliedEffect(choice);

    ui.feedback.hidden = false;
    ui.feedback.innerHTML = `
      <span class="ddos-badge">${choice.feedback.badge}</span>
      <span>${choice.feedback.text}</span>
      <div style="margin-top:8px;color:#333">
        <strong>–≠—Ñ—Ñ–µ–∫—Ç:</strong>
        +${applied.minutes} –º–∏–Ω,
        –ø—Ä–æ—Å—Ç–æ–π +${applied.downtime} –º–∏–Ω,
        —Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —É—Ä–æ–Ω +${applied.rep}
        ${applied.lossExtra ? `, –¥–æ–ø.—Ä–∞—Å—Ö–æ–¥—ã ‚ÇΩ ${formatMoney(applied.lossExtra)}` : ""}
        ${applied.churn ? `, —Å–∫—Ä—ã—Ç—ã–µ –ø–æ—Ç–µ—Ä–∏ ‚ÇΩ ${formatMoney(applied.churn)}` : ""}
      </div>
    `;

    ui.btnNext.disabled = false;
  }

  function applyChoiceAndGoNext(){
    const node = nodes[state.nodeId];
    if (selectedIndex == null) return;
    const choice = node.choices[selectedIndex];
    const applied = computeAppliedEffect(choice);

    state.history.push({
      nodeId: state.nodeId,
      minutes: state.minutes,
      downtime: state.downtime,
      rep: state.rep,
      extras: state._extras || 0,
      churn: state._churn || 0
    });

    state.minutes += applied.minutes;
    state.downtime += applied.downtime;
    state.rep += applied.rep;
    state._extras = (state._extras || 0) + (applied.lossExtra || 0);
    state._churn  = (state._churn  || 0) + (applied.churn || 0);

    state.nodeId = pendingNext;
    selectedIndex = null;
    pendingNext = null;

    renderStats();
    renderNode();
  }

  function goBack(){
    const prev = state.history.pop();
    if (!prev) return;

    state.nodeId = prev.nodeId;
    state.minutes = prev.minutes;
    state.downtime = prev.downtime;
    state.rep = prev.rep;
    state._extras = prev.extras;
    state._churn = prev.churn;

    selectedIndex = null;
    pendingNext = null;

    renderStats();
    renderNode();
  }

  function resetAll(){
    state.nodeId = "start";
    state.minutes = 0;
    state.downtime = 0;
    state.rep = 0;
    state.loss = 0;
    state._extras = 0;
    state._churn = 0;
    state.history = [];

    selectedIndex = null;
    pendingNext = null;

    renderStats();
    renderNode();
  }

  ui.btnNext.addEventListener("click", applyChoiceAndGoNext);
  ui.btnBack.addEventListener("click", goBack);
  ui.btnReset.addEventListener("click", resetAll);

  resetAll();
})();
</script>
